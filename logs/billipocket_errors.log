[2025-08-12 10:26:16,241] ERROR in app.routes.invoices.invoices.change_status: Error changing status for invoice 2 to maksmata: (sqlite3.IntegrityError) CHECK constraint failed: check_status_valid
[SQL: UPDATE invoices SET status=?, updated_at=? WHERE invoices.id = ?]
[parameters: ('maksmata', '2025-08-12 07:26:16.238201', 2)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
[2025-08-12 10:26:29,172] ERROR in app.routes.invoices.invoices.change_status: Error changing status for invoice 2 to maksmata: (sqlite3.IntegrityError) CHECK constraint failed: check_status_valid
[SQL: UPDATE invoices SET status=?, updated_at=? WHERE invoices.id = ?]
[parameters: ('maksmata', '2025-08-12 07:26:29.171162', 2)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
[2025-08-12 10:59:13,164] ERROR in app.routes.invoices.invoices.duplicate_invoice: Error duplicating invoice 2: (sqlite3.IntegrityError) CHECK constraint failed: status IN ('maksmata', 'makstud')
[SQL: INSERT INTO invoices (number, client_id, date, due_date, subtotal, vat_rate_id, vat_rate, total, status, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-0003', 2, '2025-08-12', '2025-08-25', 0.0, 4, 24.0, 0.0, 'mustand', '2025-08-12 07:59:13.163223', '2025-08-12 07:59:13.163228')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
[2025-08-12 14:31:10,935] ERROR in app.routes.invoices.invoices.edit_invoice: Form field issue when populating line 1: 'str' object has no attribute 'data'
[2025-08-12 14:31:10,936] ERROR in app.routes.invoices.invoices.edit_invoice: Form field issue when populating line 2: 'str' object has no attribute 'data'
[2025-08-12 14:31:11,030] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-12 14:31:11,030] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'payment_terms': ['Not a valid choice.']}
[2025-08-12 14:31:11,030] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'payment_terms': Not a valid choice.
[2025-08-12 14:31:40,248] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-12 14:31:40,248] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'payment_terms': ['Not a valid choice.']}
[2025-08-12 14:31:40,248] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'payment_terms': Not a valid choice.
[2025-08-12 14:32:24,712] ERROR in app.routes.invoices.invoices.edit_invoice: Error updating invoice 1: 'str' object has no attribute 'data'
[2025-08-13 17:02:10,748] ERROR in app.routes.invoices.invoices.duplicate_invoice: Error duplicating invoice 3: (sqlite3.IntegrityError) CHECK constraint failed: status IN ('maksmata', 'makstud')
[SQL: INSERT INTO invoices (number, client_id, date, due_date, subtotal, vat_rate_id, vat_rate, total, status, payment_terms, client_extra_info, note, announcements, pdf_template, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-0004', 1, '2025-08-13', '2025-08-26', 0.0, 4, 24.0, 0.0, 'mustand', None, None, None, None, 'standard', '2025-08-13 14:02:10.746515', '2025-08-13 14:02:10.746520')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
[2025-08-13 17:02:30,151] ERROR in app.routes.invoices.invoices.duplicate_invoice: Error duplicating invoice 3: (sqlite3.IntegrityError) CHECK constraint failed: status IN ('maksmata', 'makstud')
[SQL: INSERT INTO invoices (number, client_id, date, due_date, subtotal, vat_rate_id, vat_rate, total, status, payment_terms, client_extra_info, note, announcements, pdf_template, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-0004', 1, '2025-08-13', '2025-08-26', 0.0, 4, 24.0, 0.0, 'mustand', None, None, None, None, 'standard', '2025-08-13 14:02:30.151098', '2025-08-13 14:02:30.151102')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
[2025-08-13 17:03:11,570] ERROR in app.routes.invoices.invoices.duplicate_invoice: Error duplicating invoice 3: (sqlite3.IntegrityError) CHECK constraint failed: status IN ('maksmata', 'makstud')
[SQL: INSERT INTO invoices (number, client_id, date, due_date, subtotal, vat_rate_id, vat_rate, total, status, payment_terms, client_extra_info, note, announcements, pdf_template, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-0004', 1, '2025-08-13', '2025-08-26', 0.0, 4, 24.0, 0.0, 'mustand', None, None, None, None, 'standard', '2025-08-13 14:03:11.569965', '2025-08-13 14:03:11.569971')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
[2025-08-13 17:22:30,014] ERROR in app.routes.invoices.invoices.edit_invoice: Error accessing line form fields: 'str' object has no attribute 'data'
[2025-08-13 17:54:03,082] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-13 17:54:03,082] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'payment_terms': ['Not a valid choice.']}
[2025-08-13 17:54:03,082] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'payment_terms': Not a valid choice.
[2025-08-13 17:54:43,424] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-13 17:54:43,424] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'payment_terms': ['Not a valid choice.']}
[2025-08-13 17:54:43,424] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'payment_terms': Not a valid choice.
[2025-08-13 17:55:16,055] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-13 17:55:16,055] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'payment_terms': ['Not a valid choice.']}
[2025-08-13 17:55:16,055] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'payment_terms': Not a valid choice.
[2025-08-13 17:55:40,961] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-13 17:55:40,961] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'payment_terms': ['Not a valid choice.']}
[2025-08-13 17:55:40,961] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'payment_terms': Not a valid choice.
[2025-08-13 23:47:09,131] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-13 23:47:09,131] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'number': ['Arve number on kohustuslik'], 'client_id': ['Klient on kohustuslik'], 'date': ['Arve kuupäev on kohustuslik']}
[2025-08-13 23:47:09,131] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'number': Arve number on kohustuslik
[2025-08-13 23:47:09,131] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'client_id': Klient on kohustuslik
[2025-08-13 23:47:09,131] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'date': Arve kuupäev on kohustuslik
[2025-08-13 23:47:09,143] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-13 23:47:09,143] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'number': ['Arve number peab olema kujul AAAA-NNNN (näiteks: 2025-0001).']}
[2025-08-13 23:47:09,143] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'number': Arve number peab olema kujul AAAA-NNNN (näiteks: 2025-0001).
[2025-08-13 23:47:35,198] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-13 23:47:35,198] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'number': ['Arve number on kohustuslik'], 'client_id': ['Klient on kohustuslik'], 'date': ['Arve kuupäev on kohustuslik'], 'lines': [{'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-13 23:47:35,198] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'number': Arve number on kohustuslik
[2025-08-13 23:47:35,199] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'client_id': Klient on kohustuslik
[2025-08-13 23:47:35,199] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'date': Arve kuupäev on kohustuslik
[2025-08-13 23:47:35,199] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-13 23:51:04,910] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-13 23:51:04,912] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'number': ['Arve number on kohustuslik'], 'client_id': ['Klient on kohustuslik'], 'lines': [{'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-13 23:51:04,913] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'number': Arve number on kohustuslik
[2025-08-13 23:51:04,913] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'client_id': Klient on kohustuslik
[2025-08-13 23:51:04,914] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-13 23:51:04,929] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-13 23:51:04,929] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'number': ['Arve number peab olema kujul AAAA-NNNN (näiteks: 2025-0001).']}
[2025-08-13 23:51:04,930] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'number': Arve number peab olema kujul AAAA-NNNN (näiteks: 2025-0001).
[2025-08-14 10:13:22,388] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-14 10:13:22,389] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'number': ['Arve number on kohustuslik'], 'client_id': ['Klient on kohustuslik'], 'lines': [{'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-14 10:13:22,389] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'number': Arve number on kohustuslik
[2025-08-14 10:13:22,389] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'client_id': Klient on kohustuslik
[2025-08-14 10:13:22,389] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-14 10:14:11,644] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-14 10:14:11,644] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'number': ['Arve number on kohustuslik'], 'client_id': ['Klient on kohustuslik'], 'lines': [{'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-14 10:14:11,644] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'number': Arve number on kohustuslik
[2025-08-14 10:14:11,644] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'client_id': Klient on kohustuslik
[2025-08-14 10:14:11,644] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-14 10:14:54,736] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-14 10:14:54,736] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-14 10:14:54,737] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-14 10:15:11,437] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-14 10:15:11,437] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-14 10:15:11,438] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-14 14:21:37,945] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-14 14:21:37,945] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'number': ['Arve number peab olema kujul AAAA-NNNN (näiteks: 2025-0001).']}
[2025-08-14 14:21:37,946] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'number': Arve number peab olema kujul AAAA-NNNN (näiteks: 2025-0001).
[2025-08-14 14:21:52,083] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-14 14:21:52,084] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'number': ['Arve number "2025-0001" on juba kasutusel.']}
[2025-08-14 14:21:52,084] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'number': Arve number "2025-0001" on juba kasutusel.
[2025-08-16 03:00:31,528] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-16 03:00:31,528] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'number': ['Arve number peab olema kujul AAAA-NNNN (näiteks: 2025-0001).']}
[2025-08-16 03:00:31,529] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'number': Arve number peab olema kujul AAAA-NNNN (näiteks: 2025-0001).
[2025-08-16 03:04:18,323] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-16 03:04:18,324] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'number': ['Arve number peab olema kujul AAAA-NNNN (näiteks: 2025-0001).']}
[2025-08-16 03:04:18,324] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'number': Arve number peab olema kujul AAAA-NNNN (näiteks: 2025-0001).
[2025-08-16 22:52:46,761] ERROR in app.routes.pdf.pdf.invoice_preview: Preview generation error for invoice 4: 'client' is undefined
Traceback (most recent call last):
  File "/Users/keijovalting/Downloads/billipocket_gpt5/app/routes/pdf.py", line 118, in invoice_preview
    return render_template(
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/flask/templating.py", line 150, in render_template
    return _render(app, template, context)
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/flask/templating.py", line 131, in _render
    rv = template.render(context)
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 1301, in render
    self.environment.handle_exception()
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 936, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/keijovalting/Downloads/billipocket_gpt5/templates/pdf/invoice_modern.html", line 502, in top-level template code
    <div class="client-name">{{ client.name }}</div>
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 485, in getattr
    return getattr(obj, attribute)
jinja2.exceptions.UndefinedError: 'client' is undefined
[2025-08-16 22:52:58,201] ERROR in app.routes.pdf.pdf.invoice_preview: Preview generation error for invoice 4: 'client' is undefined
Traceback (most recent call last):
  File "/Users/keijovalting/Downloads/billipocket_gpt5/app/routes/pdf.py", line 118, in invoice_preview
    return render_template(
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/flask/templating.py", line 150, in render_template
    return _render(app, template, context)
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/flask/templating.py", line 131, in _render
    rv = template.render(context)
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 1301, in render
    self.environment.handle_exception()
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 936, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/keijovalting/Downloads/billipocket_gpt5/templates/pdf/invoice_elegant.html", line 412, in top-level template code
    <div class="client-name">{{ client.name }}</div>
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 485, in getattr
    return getattr(obj, attribute)
jinja2.exceptions.UndefinedError: 'client' is undefined
[2025-08-16 22:53:02,229] ERROR in app.routes.pdf.pdf.invoice_preview: Preview generation error for invoice 4: 'client' is undefined
Traceback (most recent call last):
  File "/Users/keijovalting/Downloads/billipocket_gpt5/app/routes/pdf.py", line 118, in invoice_preview
    return render_template(
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/flask/templating.py", line 150, in render_template
    return _render(app, template, context)
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/flask/templating.py", line 131, in _render
    rv = template.render(context)
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 1301, in render
    self.environment.handle_exception()
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 936, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/keijovalting/Downloads/billipocket_gpt5/templates/pdf/invoice_minimal.html", line 352, in top-level template code
    <div class="client-name">{{ client.name }}</div>
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 485, in getattr
    return getattr(obj, attribute)
jinja2.exceptions.UndefinedError: 'client' is undefined
[2025-08-16 22:53:54,955] ERROR in app.routes.pdf.pdf.invoice_preview: Preview generation error for invoice 4: 'client' is undefined
Traceback (most recent call last):
  File "/Users/keijovalting/Downloads/billipocket_gpt5/app/routes/pdf.py", line 118, in invoice_preview
    return render_template(
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/flask/templating.py", line 150, in render_template
    return _render(app, template, context)
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/flask/templating.py", line 131, in _render
    rv = template.render(context)
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 1301, in render
    self.environment.handle_exception()
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 936, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/keijovalting/Downloads/billipocket_gpt5/templates/pdf/invoice_modern.html", line 502, in top-level template code
    <div class="client-name">{{ client.name }}</div>
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 485, in getattr
    return getattr(obj, attribute)
jinja2.exceptions.UndefinedError: 'client' is undefined
[2025-08-16 22:54:26,304] ERROR in app.routes.pdf.pdf.invoice_preview: Preview generation error for invoice 4: 'client' is undefined
Traceback (most recent call last):
  File "/Users/keijovalting/Downloads/billipocket_gpt5/app/routes/pdf.py", line 118, in invoice_preview
    return render_template(
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/flask/templating.py", line 150, in render_template
    return _render(app, template, context)
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/flask/templating.py", line 131, in _render
    rv = template.render(context)
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 1301, in render
    self.environment.handle_exception()
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 936, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/keijovalting/Downloads/billipocket_gpt5/templates/pdf/invoice_modern.html", line 502, in top-level template code
    <div class="client-name">{{ client.name }}</div>
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 485, in getattr
    return getattr(obj, attribute)
jinja2.exceptions.UndefinedError: 'client' is undefined
[2025-08-16 22:55:31,741] ERROR in app.routes.pdf.pdf.invoice_preview: Preview generation error for invoice 4: 'client' is undefined
Traceback (most recent call last):
  File "/Users/keijovalting/Downloads/billipocket_gpt5/app/routes/pdf.py", line 118, in invoice_preview
    return render_template(
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/flask/templating.py", line 150, in render_template
    return _render(app, template, context)
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/flask/templating.py", line 131, in _render
    rv = template.render(context)
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 1301, in render
    self.environment.handle_exception()
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 936, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/Users/keijovalting/Downloads/billipocket_gpt5/templates/pdf/invoice_modern.html", line 502, in top-level template code
    <div class="client-name">{{ client.name }}</div>
  File "/Users/keijovalting/Library/Python/3.9/lib/python/site-packages/jinja2/environment.py", line 485, in getattr
    return getattr(obj, attribute)
jinja2.exceptions.UndefinedError: 'client' is undefined
[2025-08-21 10:27:26,543] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:27:26,543] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:27:26,543] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:27:26,544] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:27:26,544] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:27:26,544] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:27:26,544] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'description': ['Kirjeldus on kohustuslik'], 'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:27:40,808] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:27:40,808] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:27:40,809] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:27:40,809] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:27:40,809] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:27:40,809] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:27:40,810] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:28:35,136] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:28:35,136] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:28:35,136] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:35,137] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:35,137] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:35,137] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:35,137] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:28:50,988] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:28:50,988] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:28:50,989] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:50,989] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:50,989] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:50,989] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:50,989] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:28:52,604] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:28:52,604] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:28:52,605] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:52,605] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:52,605] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:52,606] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:52,606] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:28:53,614] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:28:53,614] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:28:53,614] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:53,614] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:53,614] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:53,614] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:53,615] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:28:54,358] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:28:54,358] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:28:54,358] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:54,358] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:54,358] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:54,359] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:54,359] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:28:55,200] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:28:55,200] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:28:55,201] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:55,201] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:55,201] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:55,202] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:55,202] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:28:56,002] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:28:56,002] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:28:56,003] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:56,003] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:56,003] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:56,003] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:56,003] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:28:57,208] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:28:57,209] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:28:57,209] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:57,209] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:57,209] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:57,210] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:57,210] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:28:58,236] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:28:58,237] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:28:58,237] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:58,238] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:58,238] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:58,238] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:28:58,239] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:29:05,284] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:29:05,285] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:29:05,285] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:05,285] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:05,286] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:05,286] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:05,286] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:29:12,845] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:29:12,845] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:29:12,846] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:12,846] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:12,846] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:12,846] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:12,847] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 10:29:22,881] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:29:22,882] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik']}]}
[2025-08-21 10:29:22,882] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:22,882] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:22,883] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:22,883] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:22,883] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik']}
[2025-08-21 10:29:29,633] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-21 10:29:29,633] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'lines': [{}, {}, {}, {}, {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}]}
[2025-08-21 10:29:29,634] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:29,634] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:29,634] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:29,634] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {}
[2025-08-21 10:29:29,634] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'lines': {'qty': ['Kogus on kohustuslik'], 'unit_price': ['Ühiku hind on kohustuslik']}
[2025-08-21 13:04:29,663] ERROR in app.routes.dashboard.dashboard.settings: Error getting note labels: (sqlite3.OperationalError) no such table: note_labels
[SQL: SELECT note_labels.id AS note_labels_id, note_labels.name AS note_labels_name, note_labels.is_active AS note_labels_is_active, note_labels.is_default AS note_labels_is_default, note_labels.created_at AS note_labels_created_at, note_labels.updated_at AS note_labels_updated_at 
FROM note_labels 
WHERE note_labels.is_active = 1 ORDER BY note_labels.name]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2025-08-21 13:04:45,901] ERROR in app.routes.dashboard.dashboard.create_note_label: Error creating note label: (sqlite3.OperationalError) no such table: note_labels
[SQL: SELECT note_labels.id AS note_labels_id, note_labels.name AS note_labels_name, note_labels.is_active AS note_labels_is_active, note_labels.is_default AS note_labels_is_default, note_labels.created_at AS note_labels_created_at, note_labels.updated_at AS note_labels_updated_at 
FROM note_labels 
WHERE note_labels.name = ?
 LIMIT ? OFFSET ?]
[parameters: ('Märkus', 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2025-08-21 13:04:51,249] ERROR in app.routes.dashboard.dashboard.create_note_label: Error creating note label: (sqlite3.OperationalError) no such table: note_labels
[SQL: SELECT note_labels.id AS note_labels_id, note_labels.name AS note_labels_name, note_labels.is_active AS note_labels_is_active, note_labels.is_default AS note_labels_is_default, note_labels.created_at AS note_labels_created_at, note_labels.updated_at AS note_labels_updated_at 
FROM note_labels 
WHERE note_labels.name = ?
 LIMIT ? OFFSET ?]
[parameters: ('Märkus', 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2025-08-21 13:19:57,397] ERROR in app.routes.dashboard.dashboard.settings: Error getting note labels: (sqlite3.OperationalError) no such table: note_labels
[SQL: SELECT note_labels.id AS note_labels_id, note_labels.name AS note_labels_name, note_labels.is_active AS note_labels_is_active, note_labels.is_default AS note_labels_is_default, note_labels.created_at AS note_labels_created_at, note_labels.updated_at AS note_labels_updated_at 
FROM note_labels 
WHERE note_labels.is_active = 1 ORDER BY note_labels.name]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2025-08-21 13:20:10,130] ERROR in app.routes.dashboard.dashboard.create_note_label: Error creating note label: (sqlite3.OperationalError) no such table: note_labels
[SQL: SELECT note_labels.id AS note_labels_id, note_labels.name AS note_labels_name, note_labels.is_active AS note_labels_is_active, note_labels.is_default AS note_labels_is_default, note_labels.created_at AS note_labels_created_at, note_labels.updated_at AS note_labels_updated_at 
FROM note_labels 
WHERE note_labels.name = ?
 LIMIT ? OFFSET ?]
[parameters: ('Viitenumber', 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2025-08-21 13:27:57,894] ERROR in app.routes.dashboard.dashboard.settings: Error getting note labels: (sqlite3.OperationalError) no such table: note_labels
[SQL: SELECT note_labels.id AS note_labels_id, note_labels.name AS note_labels_name, note_labels.is_active AS note_labels_is_active, note_labels.is_default AS note_labels_is_default, note_labels.created_at AS note_labels_created_at, note_labels.updated_at AS note_labels_updated_at 
FROM note_labels 
WHERE note_labels.is_active = 1 ORDER BY note_labels.name]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2025-08-21 13:28:05,844] ERROR in app.routes.dashboard.dashboard.settings: Error getting note labels: (sqlite3.OperationalError) no such table: note_labels
[SQL: SELECT note_labels.id AS note_labels_id, note_labels.name AS note_labels_name, note_labels.is_active AS note_labels_is_active, note_labels.is_default AS note_labels_is_default, note_labels.created_at AS note_labels_created_at, note_labels.updated_at AS note_labels_updated_at 
FROM note_labels 
WHERE note_labels.is_active = 1 ORDER BY note_labels.name]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2025-08-21 13:28:21,112] ERROR in app.routes.dashboard.dashboard.create_note_label: Error creating note label: (sqlite3.OperationalError) no such table: note_labels
[SQL: SELECT note_labels.id AS note_labels_id, note_labels.name AS note_labels_name, note_labels.is_active AS note_labels_is_active, note_labels.is_default AS note_labels_is_default, note_labels.created_at AS note_labels_created_at, note_labels.updated_at AS note_labels_updated_at 
FROM note_labels 
WHERE note_labels.name = ?
 LIMIT ? OFFSET ?]
[parameters: ('Viitenumber', 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2025-08-21 13:28:38,823] ERROR in app.routes.dashboard.dashboard.settings: Error getting note labels: (sqlite3.OperationalError) no such table: note_labels
[SQL: SELECT note_labels.id AS note_labels_id, note_labels.name AS note_labels_name, note_labels.is_active AS note_labels_is_active, note_labels.is_default AS note_labels_is_default, note_labels.created_at AS note_labels_created_at, note_labels.updated_at AS note_labels_updated_at 
FROM note_labels 
WHERE note_labels.is_active = 1 ORDER BY note_labels.name]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2025-08-24 01:01:26,459] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-24 01:01:26,462] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'status': ['Not a valid choice.', 'Vigane staatus: ']}
[2025-08-24 01:01:26,463] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'status': Not a valid choice.
[2025-08-24 01:01:26,463] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'status': Vigane staatus: 
[2025-08-24 01:01:57,873] ERROR in app.routes.invoices.invoices.edit_invoice: Form validation failed for invoice edit
[2025-08-24 01:01:57,873] ERROR in app.routes.invoices.invoices.edit_invoice: Form errors: {'status': ['Not a valid choice.', 'Vigane staatus: ']}
[2025-08-24 01:01:57,873] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'status': Not a valid choice.
[2025-08-24 01:01:57,874] ERROR in app.routes.invoices.invoices.edit_invoice: Field 'status': Vigane staatus: 
