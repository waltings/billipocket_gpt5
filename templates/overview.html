{% extends 'layout.html' %}
{% block title %}Ülevaade – Billipocket{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* Override Bootstrap primary colors to match app theme */
:root {
    --bs-primary: #114f68;
    --bs-primary-rgb: 17, 79, 104;
}

.btn-outline-primary {
    color: #114f68 !important;
    border-color: #114f68 !important;
    background-color: transparent !important;
}

.btn-outline-primary:hover {
    background-color: #114f68 !important;
    border-color: #114f68 !important;
    color: white !important;
}

.btn-outline-primary:focus {
    background-color: transparent !important;
    color: #114f68 !important;
    border-color: #114f68 !important;
    box-shadow: 0 0 0 0.2rem rgba(17, 79, 104, 0.25) !important;
}

.btn-outline-primary:active {
    background-color: #114f68 !important;
    border-color: #114f68 !important;
    color: white !important;
}
</style>
{% endblock %}

{% block content %}
<section id="dashboard" class="mb-4">
  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="fw-bold mb-1" style="font-size: 1.8rem;">Ülevaade</h1>
    </div>
    <div class="d-flex gap-2">
      <a href="{{ url_for('invoices.new_invoice') }}" class="btn btn-primary">
        <i class="bi bi-plus-lg me-1"></i>Loo arve
      </a>
      <a href="{{ url_for('clients.clients') }}" class="btn btn-outline-primary">
        <i class="bi bi-person-plus me-1"></i>Lisa klient
      </a>
    </div>
  </div>

  <!-- Alert Section for Overdue Invoices -->
  {% if metrics.overdue_count > 0 %}
  <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-3 fs-4"></i>
    <div class="flex-grow-1">
      <strong>Hoiatus!</strong> Teil on {{ metrics.overdue_count }} tähtaja ületanud arvet summas {{ "%.2f"|format(metrics.overdue_amount) }}€.
      <a href="{{ url_for('invoices.invoices', status='maksmata', sort='due_date', dir='asc') }}" class="alert-link ms-2">Vaata tähtaja ületanud arveid</a>
    </div>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  {% endif %}

  <!-- KPI Cards -->
  <div class="row g-3 mb-4">
    <div class="col-12 col-lg-4">
      <div class="d-flex align-items-center p-3" style="background: white; border-radius: 16px; border: 1px solid #e2e8f0;">
        <div class="me-3">
          <div class="d-flex align-items-center justify-content-center" style="width: 48px; height: 48px; background: #eff6ff; border-radius: 12px;">
            <i class="bi bi-graph-up" style="color: #2563eb; font-size: 1.5rem;"></i>
          </div>
        </div>
        <div class="flex-grow-1">
          <div class="fw-bold" style="color: #0f172a; font-size: 1rem; margin-bottom: 2px;">Käive (kuu)</div>
          <div class="fw-bold" style="color: #2563eb; font-size: 1.1rem;">{{ "%.2f"|format(metrics.revenue_month) }}€</div>
        </div>
      </div>
    </div>
    
    <div class="col-12 col-lg-4">
      <div class="d-flex align-items-center p-3" style="background: white; border-radius: 16px; border: 1px solid #bbf7d0;">
        <div class="me-3">
          <div class="d-flex align-items-center justify-content-center" style="width: 48px; height: 48px; background: #d1fae5; border-radius: 12px;">
            <i class="bi bi-cash-coin" style="color: #059669; font-size: 1.5rem;"></i>
          </div>
        </div>
        <div class="flex-grow-1">
          <div class="fw-bold" style="color: #0f172a; font-size: 1rem; margin-bottom: 2px;">Laekumised kokku</div>
          <div class="fw-bold" style="color: #059669; font-size: 1.1rem;">{{ "%.2f"|format(metrics.cash_in) }}€</div>
        </div>
      </div>
    </div>
    
    <div class="col-12 col-lg-4">
      <div class="d-flex align-items-center p-3" style="background: white; border-radius: 16px; border: 1px solid #fde68a;">
        <div class="me-3">
          <div class="d-flex align-items-center justify-content-center" style="width: 48px; height: 48px; background: #fef3c7; border-radius: 12px;">
            <i class="bi bi-clock-fill" style="color: #d97706; font-size: 1.5rem;"></i>
          </div>
        </div>
        <div class="flex-grow-1">
          <div class="fw-bold" style="color: #0f172a; font-size: 1rem; margin-bottom: 2px;">Maksmata arved</div>
          <div class="fw-bold" style="color: #d97706; font-size: 1.1rem;">{{ "%.2f"|format(metrics.outstanding) }}€</div>
        </div>
        <div class="ms-2">
          <div class="d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; border: 2px solid #d97706; border-radius: 8px; background: white;">
            <span class="fw-bold" style="color: #d97706; font-size: 0.9rem;">{{ metrics.unpaid }}</span>
          </div>
        </div>
      </div>
    </div>
    
  </div>


  <!-- Charts Section -->
  <div class="row g-3 mb-4">
    <!-- Revenue Trend Chart -->
    <div class="col-12 col-lg-6">
      <div class="bp-card h-100">
        <div class="bp-card-header d-flex align-items-center justify-content-between">
          <h3 class="h6 m-0">
            <i class="bi bi-bar-chart me-2"></i>Arvete summa kuude lõikes
          </h3>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-primary btn-sm" onclick="exportRevenueChart()">
              <i class="bi bi-download me-1"></i>Ekspordi
            </button>
          </div>
        </div>
        <div class="bp-card-body">
          <canvas id="monthlyRevenueChart" height="300"></canvas>
        </div>
      </div>
    </div>

    <!-- Top Customers Chart -->
    <div class="col-12 col-lg-6">
      <div class="bp-card h-100">
        <div class="bp-card-header d-flex align-items-center justify-content-between">
          <h3 class="h6 m-0">
            <i class="bi bi-people me-2"></i>Top 10 klienti arvete summa järgi
          </h3>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-primary btn-sm" onclick="exportCustomerChart()">
              <i class="bi bi-download me-1"></i>Ekspordi
            </button>
          </div>
        </div>
        <div class="bp-card-body">
          <canvas id="topCustomersChart" height="300"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Three Column Layout: Activities, Recent Invoices, Overdue -->
  <div class="row g-3 mb-4">
    <!-- Recent Activities -->
    <div class="col-12 col-lg-4">
      <div class="bp-card h-100">
        <div class="bp-card-header">
          <h3 class="h6 m-0">
            <i class="bi bi-activity me-2"></i>Viimased tegevused
          </h3>
        </div>
        <div class="bp-card-body p-0">
          {% if recent_invoices %}
          <div class="list-group list-group-flush">
            {% for invoice in recent_invoices[:3] %}
            <div class="list-group-item d-flex align-items-start">
              <div class="me-3">
                {% if invoice.status == 'makstud' %}
                <div class="d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; background: #f0fdf4; border-radius: 8px;">
                  <i class="bi bi-check-circle" style="color: #059669; font-size: 1rem;"></i>
                </div>
                {% elif invoice.status == 'saadetud' %}
                <div class="d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; background: #fef3c7; border-radius: 8px;">
                  <i class="bi bi-send" style="color: #d97706; font-size: 1rem;"></i>
                </div>
                {% elif invoice.status == 'mustand' %}
                <div class="d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; background: #f8fafc; border-radius: 8px;">
                  <i class="bi bi-file-earmark-text" style="color: #64748b; font-size: 1rem;"></i>
                </div>
                {% else %}
                <div class="d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; background: #eff6ff; border-radius: 8px;">
                  <i class="bi bi-plus-circle" style="color: #2563eb; font-size: 1rem;"></i>
                </div>
                {% endif %}
              </div>
              <div class="me-auto">
                {% if invoice.status == 'makstud' %}
                <div class="fw-medium small">Makse laekunud</div>
                <small class="text-muted">{{ invoice.client }} - {{ invoice.no }}</small>
                {% elif invoice.status == 'saadetud' %}
                <div class="fw-medium small">Arve saadetud</div>
                <small class="text-muted">{{ invoice.client }} - {{ invoice.no }}</small>
                {% elif invoice.status == 'mustand' %}
                <div class="fw-medium small">Mustand salvestatud</div>
                <small class="text-muted">{{ invoice.client }} - {{ invoice.no }}</small>
                {% else %}
                <div class="fw-medium small">Arve loodud</div>
                <small class="text-muted">{{ invoice.client }} - {{ invoice.no }}</small>
                {% endif %}
                <div class="small text-muted">{{ invoice.date.split('-')[2] + '.' + invoice.date.split('-')[1] + '.' + invoice.date.split('-')[0] if invoice.date else '' }}</div>
              </div>
              <div class="text-end">
                <div class="fw-medium" style="color: #2563eb;">{{ invoice.total|currency }}€</div>
              </div>
            </div>
            {% endfor %}
          </div>
          <div class="p-3 text-center border-top">
            <a href="{{ url_for('invoices.invoices') }}" class="btn btn-outline-primary btn-sm">
              <i class="bi bi-arrow-right me-1"></i>Vaata kõiki arveid
            </a>
          </div>
          {% else %}
          <div class="text-center py-4">
            <i class="bi bi-activity display-4 text-muted"></i>
            <div class="h6 text-muted mt-2">Tegevused puuduvad</div>
            <p class="text-muted small mb-3">Alustage oma esimese arve loomisega</p>
            <a href="{{ url_for('invoices.new_invoice') }}" class="btn btn-primary btn-sm">
              <i class="bi bi-plus-lg me-1"></i>Loo arve
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Recent Invoices -->
    <div class="col-12 col-lg-4">
      <div class="bp-card h-100">
        <div class="bp-card-header">
          <h3 class="h6 m-0">
            <i class="bi bi-clock-history me-2"></i>Viimased arved
          </h3>
        </div>
        <div class="bp-card-body p-0">
          {% if recent_invoices %}
          <div class="list-group list-group-flush">
            {% for invoice in recent_invoices %}
            <div class="list-group-item d-flex justify-content-between align-items-start">
              <div class="me-auto">
                <div class="fw-medium">{{ invoice.no }}</div>
                <small class="text-muted">{{ invoice.client }}</small>
                <div class="small text-muted">{{ invoice.date.split('-')[2] + '.' + invoice.date.split('-')[1] + '.' + invoice.date.split('-')[0] if invoice.date else '' }}</div>
              </div>
              <div class="text-end">
                <div class="fw-medium">{{ invoice.total|currency }}€</div>
                {% if invoice.status == 'makstud' %}
                <span class="badge bg-success small" style="background-color: #ffffff !important; color: #059669 !important; border: 1px solid #059669 !important;">Makstud</span>
                {% elif invoice.status == 'saadetud' %}
                <span class="badge bg-primary small" style="background-color: #ffffff !important; color: #2563eb !important; border: 1px solid #2563eb !important;">Saadetud</span>
                {% elif invoice.status == 'mustand' %}
                <span class="badge bg-secondary small" style="background-color: #ffffff !important; color: #64748b !important; border: 1px solid #64748b !important;">Mustand</span>
                {% elif invoice.status == 'tähtaeg ületatud' %}
                <span class="badge bg-danger small" style="background-color: #ffffff !important; color: #dc3545 !important; border: 1px solid #dc3545 !important;">Tähtaeg ületatud</span>
                {% else %}
                <span class="badge bg-warning small" style="background-color: #ffffff !important; color: #ca8a04 !important; border: 1px solid #ca8a04 !important;">Maksmata</span>
                {% endif %}
              </div>
            </div>
            {% endfor %}
          </div>
          <div class="p-3 text-center border-top">
            <a href="{{ url_for('invoices.invoices') }}" class="btn btn-outline-primary btn-sm">
              <i class="bi bi-arrow-right me-1"></i>Vaata kõiki arveid
            </a>
          </div>
          {% else %}
          <div class="text-center py-4">
            <i class="bi bi-file-earmark-text display-4 text-muted"></i>
            <div class="h6 text-muted mt-2">Arveid pole veel</div>
            <p class="text-muted small mb-3">Alustage oma esimese arve loomisega</p>
            <a href="{{ url_for('invoices.new_invoice') }}" class="btn btn-primary btn-sm">
              <i class="bi bi-plus-lg me-1"></i>Loo esimene arve
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Right Column: Two Cards Stacked -->
    <div class="col-12 col-lg-4">
      <div class="row g-3 h-100">
        <!-- Overdue Invoices -->
        <div class="col-12">
          <div class="bp-card">
            <div class="bp-card-header d-flex align-items-center justify-content-between">
              <h3 class="h6 m-0 text-danger">
                <i class="bi bi-exclamation-triangle me-2"></i>Tähtaja ületanud
              </h3>
              {% if metrics.overdue_count > 0 %}
              <span class="badge bg-danger" style="background-color: #ffffff !important; color: #dc3545 !important; border: 1px solid #dc3545 !important;">{{ metrics.overdue_count }}</span>
              {% endif %}
            </div>
            <div class="bp-card-body p-0">
              {% if overdue_invoices %}
              <div class="list-group list-group-flush">
                {% for invoice in overdue_invoices[:3] %}
                <div class="list-group-item d-flex justify-content-between align-items-start">
                  <div class="me-auto">
                    <div class="fw-medium text-danger">{{ invoice.no }}</div>
                    <small class="text-muted">{{ invoice.client }}</small>
                    <div class="small text-danger">{{ invoice.days_overdue }} päeva üle tähtaja</div>
                  </div>
                  <div class="text-end">
                    <div class="fw-medium text-danger">{{ invoice.total|currency }}€</div>
                    <small class="text-muted">{{ invoice.due_date.split('-')[2] + '.' + invoice.due_date.split('-')[1] + '.' + invoice.due_date.split('-')[0] if invoice.due_date else '' }}</small>
                  </div>
                </div>
                {% endfor %}
              </div>
              <div class="p-2 text-center border-top">
                <a href="{{ url_for('invoices.invoices', status='overdue', sort='due_date', dir='asc') }}" class="btn btn-outline-primary btn-sm">
                  <i class="bi bi-arrow-right me-1"></i>Vaata kõiki
                </a>
              </div>
              {% else %}
              <div class="text-center py-3">
                <i class="bi bi-check-circle display-6 text-success"></i>
                <div class="small text-muted mt-1">Kõik arved õigeaegsed</div>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
        
        <!-- Unpaid Invoices -->
        <div class="col-12">
          <div class="bp-card h-100">
            <div class="bp-card-header d-flex align-items-center justify-content-between">
              <h3 class="h6 m-0 text-warning">
                <i class="bi bi-clock me-2"></i>Maksmata arved
              </h3>
              <span class="badge bg-warning" style="background-color: #ffffff !important; color: #ca8a04 !important; border: 1px solid #ca8a04 !important;">{{ metrics.unpaid }}</span>
            </div>
            <div class="bp-card-body p-0">
              {% if recent_invoices %}
              <div class="list-group list-group-flush">
                {% for invoice in recent_invoices[:3] %}
                {% if invoice.status in ['maksmata', 'saadetud'] %}
                <div class="list-group-item d-flex justify-content-between align-items-start">
                  <div class="me-auto">
                    <div class="fw-medium">{{ invoice.no }}</div>
                    <small class="text-muted">{{ invoice.client }}</small>
                    {% if invoice.days_to_due is not none %}
                      {% if invoice.days_to_due < 0 %}
                        <div class="small text-danger">{{ -invoice.days_to_due }} päeva üle tähtaja</div>
                      {% elif invoice.days_to_due == 0 %}
                        <div class="small text-warning">Tähtab täna</div>
                      {% else %}
                        <div class="small text-muted">{{ invoice.days_to_due }} päeva tähtajani</div>
                      {% endif %}
                    {% endif %}
                  </div>
                  <div class="text-end">
                    <div class="fw-medium text-warning">{{ invoice.total|currency }}€</div>
                    {% if invoice.due_date %}
                      <small class="text-muted">{{ invoice.due_date.split('-')[2] + '.' + invoice.due_date.split('-')[1] + '.' + invoice.due_date.split('-')[0] }}</small>
                    {% endif %}
                  </div>
                </div>
                {% endif %}
                {% endfor %}
              </div>
              <div class="p-2 text-center border-top">
                <a href="{{ url_for('invoices.invoices', status='maksmata') }}" class="btn btn-outline-primary btn-sm">
                  <i class="bi bi-arrow-right me-1"></i>Vaata kõiki
                </a>
              </div>
              {% else %}
              <div class="text-center py-3">
                <i class="bi bi-check-circle display-6 text-success"></i>
                <div class="small text-muted mt-1">Kõik arved tasutud</div>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</section>
{% endblock %}

{% block extra_js %}
<script>
// Revenue Chart
const ctx = document.getElementById('revenueChart');
if (ctx) {
  // Use real data from backend
  const months = {{ metrics.monthly_labels | tojson }};
  const revenueData = {{ metrics.monthly_revenue_data | tojson }};
  
  const revenueChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: months,
      datasets: [{
        label: 'Käive (€)',
        data: revenueData,
        borderColor: 'rgb(17, 214, 222)',
        backgroundColor: 'rgba(17, 214, 222, 0.1)',
        borderWidth: 3,
        fill: true,
        tension: 0.4,
        pointBackgroundColor: 'rgb(17, 214, 222)',
        pointBorderColor: '#ffffff',
        pointBorderWidth: 2,
        pointRadius: 5,
        pointHoverRadius: 7
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          titleColor: '#ffffff',
          bodyColor: '#ffffff',
          borderColor: 'rgb(17, 214, 222)',
          borderWidth: 1,
          cornerRadius: 8,
          callbacks: {
            label: function(context) {
              return 'Käive: ' + context.parsed.y.toFixed(2) + '€';
            }
          }
        }
      },
      scales: {
        x: {
          grid: {
            display: false
          },
          border: {
            display: false
          }
        },
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          },
          border: {
            display: false
          },
          ticks: {
            callback: function(value) {
              return value.toFixed(0) + '€';
            }
          }
        }
      },
      interaction: {
        intersect: false,
        mode: 'index'
      }
    }
  });
  
  // Export chart function
  window.exportChart = function() {
    const link = document.createElement('a');
    link.download = 'kaibe-trend.png';
    link.href = revenueChart.toBase64Image();
    link.click();
  };
}

// Monthly Revenue Chart
const monthlyCtx = document.getElementById('monthlyRevenueChart');
if (monthlyCtx) {
  const months = {{ metrics.monthly_labels | tojson }};
  const revenueData = {{ metrics.monthly_revenue_data | tojson }};
  
  const monthlyRevenueChart = new Chart(monthlyCtx, {
    type: 'bar',
    data: {
      labels: months,
      datasets: [{
        label: 'Käive (€)',
        data: revenueData,
        backgroundColor: 'rgba(37, 99, 235, 0.3)',
        borderColor: 'rgba(37, 99, 235, 0.5)',
        borderWidth: 1,
        borderRadius: 6,
        borderSkipped: false,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          titleColor: '#ffffff',
          bodyColor: '#ffffff',
          borderColor: 'rgba(37, 99, 235, 0.8)',
          borderWidth: 1,
          cornerRadius: 8,
          callbacks: {
            label: function(context) {
              return 'Käive: ' + context.parsed.y.toFixed(2) + '€';
            }
          }
        }
      },
      scales: {
        x: {
          grid: {
            display: false
          },
          border: {
            display: false
          }
        },
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          },
          border: {
            display: false
          },
          ticks: {
            callback: function(value) {
              return value.toFixed(0) + '€';
            }
          }
        }
      }
    }
  });
  
  // Export function
  window.exportRevenueChart = function() {
    const link = document.createElement('a');
    link.download = 'kuude-kaive.png';
    link.href = monthlyRevenueChart.toBase64Image();
    link.click();
  };
}

// Top Customers Chart
const customersCtx = document.getElementById('topCustomersChart');
if (customersCtx) {
  // Real data from backend
  const customerData = {
    labels: {{ metrics.top_customers_labels | tojson }},
    data: {{ metrics.top_customers_data | tojson }}
  };
  
  const topCustomersChart = new Chart(customersCtx, {
    type: 'bar',
    data: {
      labels: customerData.labels,
      datasets: [{
        label: 'Arvete summa (€)',
        data: customerData.data,
        backgroundColor: 'rgba(17, 214, 222, 0.3)',
        borderColor: 'rgba(17, 214, 222, 0.5)',
        borderWidth: 1,
        borderRadius: 4,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      indexAxis: 'y',
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          titleColor: '#ffffff',
          bodyColor: '#ffffff',
          borderColor: 'rgba(17, 214, 222, 0.8)',
          borderWidth: 1,
          cornerRadius: 8,
          callbacks: {
            label: function(context) {
              return 'Summa: ' + context.parsed.x.toFixed(2) + '€';
            }
          }
        }
      },
      scales: {
        x: {
          beginAtZero: true,
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          },
          border: {
            display: false
          },
          ticks: {
            callback: function(value) {
              return value.toFixed(0) + '€';
            }
          }
        },
        y: {
          grid: {
            display: false
          },
          border: {
            display: false
          },
          ticks: {
            font: {
              size: 11
            }
          }
        }
      }
    }
  });
  
  // Export function
  window.exportCustomerChart = function() {
    const link = document.createElement('a');
    link.download = 'top-kliendid.png';
    link.href = topCustomersChart.toBase64Image();
    link.click();
  };
}

// Status Chart (Pie Chart)
const statusCtx = document.getElementById('statusChart');
if (statusCtx) {
  const statusLabels = {{ metrics.status_labels | tojson }};
  const statusValues = {{ metrics.status_values | tojson }};
  const statusColors = {{ metrics.status_colors | tojson }};
  
  const statusChart = new Chart(statusCtx, {
    type: 'doughnut',
    data: {
      labels: statusLabels,
      datasets: [{
        data: statusValues,
        backgroundColor: statusColors,
        borderWidth: 2,
        borderColor: '#ffffff',
        hoverBorderWidth: 3
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          titleColor: '#ffffff',
          bodyColor: '#ffffff',
          borderColor: 'rgb(17, 214, 222)',
          borderWidth: 1,
          cornerRadius: 8,
          callbacks: {
            label: function(context) {
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = ((context.parsed * 100) / total).toFixed(1);
              return context.label + ': ' + context.parsed + ' (' + percentage + '%)';
            }
          }
        }
      },
      cutout: '60%'
    }
  });
}

// Scroll to chart function
function scrollToChart() {
  document.getElementById('revenueChart').scrollIntoView({
    behavior: 'smooth',
    block: 'center'
  });
}

// Auto-refresh dashboard data every 5 minutes
setInterval(function() {
  // In a real implementation, you would make an AJAX call to refresh the data
  console.log('Dashboard data refresh (implementation needed)');
}, 5 * 60 * 1000);

// Add loading state for action buttons
document.addEventListener('DOMContentLoaded', function() {
  const actionButtons = document.querySelectorAll('.btn');
  
  actionButtons.forEach(button => {
    button.addEventListener('click', function() {
      if (this.href && !this.href.includes('#')) {
        this.innerHTML = '<div class="spinner-border spinner-border-sm me-1" role="status"></div>Laen...';
      }
    });
  });
});

// Welcome message based on time of day
document.addEventListener('DOMContentLoaded', function() {
  const hour = new Date().getHours();
  const welcomeText = document.querySelector('h1');
  
  if (welcomeText) {
    if (hour < 12) {
      welcomeText.textContent = 'Tere hommikust!';
    } else if (hour < 18) {
      welcomeText.textContent = 'Tere päevast!';
    } else {
      welcomeText.textContent = 'Tere õhtust!';
    }
  }
});
</script>
{% endblock %}
